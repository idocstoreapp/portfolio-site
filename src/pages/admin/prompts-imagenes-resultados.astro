---
import AdminLayout from '../../layouts/AdminLayout.astro';
import AdminSidebar from '../../components/admin/AdminSidebar';
import { getAllResultImagePrompts } from '../../utils/getAllResultImagePrompts';

const prompts = getAllResultImagePrompts();

// Agrupar por tipo de secci√≥n
const promptsBySection = prompts.reduce((acc, prompt) => {
  if (!acc[prompt.sectionType]) {
    acc[prompt.sectionType] = [];
  }
  acc[prompt.sectionType].push(prompt);
  return acc;
}, {} as Record<string, typeof prompts>);

const sectionNames: Record<string, string> = {
  'currentSituation': 'Situaci√≥n Actual',
  'opportunities': 'Oportunidades',
  'operationalImpact': 'Impacto Operativo',
  'futureVision': 'Visi√≥n Futura',
  'summary': 'Resumen',
  'opportunitySection': 'La Oportunidad',
  'insight': 'Insights Individuales'
};

const sectorNames: Record<string, string> = {
  'restaurante': 'Restaurante',
  'servicio-tecnico': 'Servicio T√©cnico',
  'taller': 'Taller',
  'fabrica': 'F√°brica',
  'comercio': 'Comercio',
  'servicios': 'Servicios'
};
---

<AdminLayout>
  <div style="position: relative; min-height: 100vh; background: #f9fafb;">
    <AdminSidebar client:load />
    
    <main style="margin-left: 16rem; min-height: 100vh; width: calc(100% - 16rem);">
      <div style="padding: 2rem; max-width: 1400px; margin: 0 auto;">
        <div style="margin-bottom: 2rem;">
          <h1 style="font-size: 2rem; font-weight: 700; color: #1f2937; margin-bottom: 0.5rem;">
            Prompts de Im√°genes para Resultados
          </h1>
          <p style="color: #6b7280; font-size: 1rem;">
            Todos los prompts de im√°genes posibles para las secciones de RESULTADOS del diagn√≥stico.
            Estas im√°genes se muestran en la p√°gina de resultados finales.
          </p>
          <p style="color: #6b7280; font-size: 0.875rem; margin-top: 0.5rem;">
            Total: {prompts.length} prompts | Organizados por tipo de secci√≥n
          </p>
        </div>

        <!-- Instrucciones -->
        <div style="background: #eff6ff; border: 1px solid #bfdbfe; border-radius: 0.5rem; padding: 1.5rem; margin-bottom: 2rem;">
          <h2 style="font-size: 1.25rem; font-weight: 600; color: #1e40af; margin-bottom: 0.75rem;">
            üìã Instrucciones
          </h2>
          <ol style="list-style: decimal; padding-left: 1.5rem; color: #1e3a8a; line-height: 1.75;">
            <li style="margin-bottom: 0.5rem;">
              <strong>Genera las im√°genes:</strong> Usa cada prompt con tu herramienta de generaci√≥n de im√°genes preferida (Midjourney, DALL-E, Stable Diffusion, etc.)
            </li>
            <li style="margin-bottom: 0.5rem;">
              <strong>Guarda con el nombre sugerido:</strong> Usa el nombre de archivo sugerido para cada imagen. Gu√°rdalas en <code style="background: #dbeafe; padding: 0.125rem 0.375rem; border-radius: 0.25rem; font-size: 0.875rem;">public/images/resultados/</code>
            </li>
            <li style="margin-bottom: 0.5rem;">
              <strong>Formato:</strong> PNG o JPG, alta calidad (m√≠nimo 1200px de ancho recomendado)
            </li>
            <li style="margin-bottom: 0.5rem;">
              <strong>Estilo:</strong> Ilustraci√≥n profesional, estilo moderno y limpio, colores c√°lidos, sin texto sobre la imagen
            </li>
          </ol>
        </div>

        <!-- Prompts por secci√≥n -->
        {Object.entries(promptsBySection).map(([sectionType, sectionPrompts]) => (
          <div style="margin-bottom: 3rem;">
            <h2 style="font-size: 1.75rem; font-weight: 700; color: #111827; margin-bottom: 1.5rem; padding-bottom: 0.75rem; border-bottom: 2px solid #e5e7eb;">
              {sectionNames[sectionType] || sectionType}
              <span style="font-size: 1rem; font-weight: 400; color: #6b7280; margin-left: 0.75rem;">
                ({sectionPrompts.length} prompts)
              </span>
            </h2>

            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(500px, 1fr)); gap: 1.5rem;">
              {sectionPrompts.map((promptInfo, index) => (
                <div style="background: white; border-radius: 0.75rem; box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06); border: 1px solid #e5e7eb; display: flex; flex-direction: column; overflow: hidden; transition: box-shadow 0.2s;">
                  <!-- Header -->
                  <div style="padding: 1.25rem; border-bottom: 1px solid #e5e7eb; background: #f9fafb;">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.75rem;">
                      <div>
                        <div style="font-weight: 600; color: #374151; margin-bottom: 0.25rem;">
                          {sectorNames[promptInfo.sector] || promptInfo.sector}
                        </div>
                        <div style="font-size: 0.875rem; color: #6b7280;">
                          {promptInfo.description}
                        </div>
                      </div>
                    </div>
                    {promptInfo.context && (
                      <div style="font-size: 0.8125rem; color: #4b5563; font-style: italic; margin-top: 0.5rem; padding-top: 0.5rem; border-top: 1px solid #e5e7eb;">
                        {promptInfo.context}
                      </div>
                    )}
                  </div>

                  <!-- Prompt Text (scrollable) -->
                  <div style="flex: 1; padding: 1.25rem; overflow-y: auto; min-height: 120px; max-height: 300px; background: #fafafa;">
                    <div style="font-family: 'Courier New', monospace; font-size: 0.875rem; line-height: 1.6; color: #1f2937; white-space: pre-wrap; word-wrap: break-word;">
                      {promptInfo.prompt}
                    </div>
                  </div>

                  <!-- Footer -->
                  <div style="padding: 1rem 1.25rem; background: #f9fafb; border-top: 1px solid #e5e7eb;">
                    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 0.75rem;">
                      <div style="flex: 1; min-width: 200px;">
                        <div style="font-size: 0.75rem; font-weight: 600; color: #6b7280; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.25rem;">
                          Nombre sugerido:
                        </div>
                        <div style="font-family: 'Courier New', monospace; font-size: 0.8125rem; color: #111827; word-break: break-all; background: white; padding: 0.5rem; border-radius: 0.375rem; border: 1px solid #d1d5db;">
                          {promptInfo.suggestedFileName}
                        </div>
                      </div>
                      <button
                        data-prompt={promptInfo.prompt}
                        class="copy-prompt-btn"
                        style="background: #3b82f6; color: white; border: none; padding: 0.5rem 1rem; border-radius: 0.375rem; font-size: 0.875rem; font-weight: 500; cursor: pointer; transition: background 0.2s; white-space: nowrap;"
                        onmouseover="this.style.background = '#2563eb'"
                        onmouseout="this.style.background = '#3b82f6'"
                      >
                        Copiar Prompt
                      </button>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        ))}
      </div>
    </main>
  </div>
</AdminLayout>

<style>
  /* Scrollbar personalizado para el √°rea de prompt */
  div[style*="overflow-y: auto"]::-webkit-scrollbar {
    width: 8px;
  }

  div[style*="overflow-y: auto"]::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 4px;
  }

  div[style*="overflow-y: auto"]::-webkit-scrollbar-thumb {
    background: #cbd5e1;
    border-radius: 4px;
  }

  div[style*="overflow-y: auto"]::-webkit-scrollbar-thumb:hover {
    background: #94a3b8;
  }

  .copy-prompt-btn:hover {
    opacity: 0.9;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const copyButtons = document.querySelectorAll('.copy-prompt-btn');
    
    copyButtons.forEach(button => {
      button.addEventListener('click', async (e) => {
        const prompt = button.getAttribute('data-prompt');
        if (prompt) {
          try {
            await navigator.clipboard.writeText(prompt);
            const originalText = button.textContent;
            button.textContent = '‚úì Copiado';
            button.style.background = '#10b981';
            setTimeout(() => {
              button.textContent = originalText;
              button.style.background = '#3b82f6';
            }, 2000);
          } catch (err) {
            console.error('Error copying to clipboard:', err);
          }
        }
      });
    });
  });
</script>
