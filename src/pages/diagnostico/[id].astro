---
// Esta p√°gina se renderiza din√°micamente en el servidor
export const prerender = false;

import Layout from '../../layouts/Layout.astro';
import { getDiagnosticResult } from '../../utils/backendClient';

interface Props {
  id: string;
}

// Obtener el ID del par√°metro de ruta
const { id } = Astro.params;

let diagnosticResult = null;
let diagnosticData = null;
let error = null;
let contactName = '';
let contactCompany = '';

try {
  if (!id) {
    throw new Error('ID de diagn√≥stico no proporcionado');
  }

  console.log('üîç Loading diagnostic with ID:', id);
  
  // Obtener el resultado procesado del backend
  const response = await getDiagnosticResult(id);
  console.log('üì• Response from getDiagnosticResult:', response);
  
  if (response.success && response.data) {
    diagnosticResult = response.data;
    console.log('‚úÖ Diagnostic result loaded:', diagnosticResult);
    
    // Tambi√©n obtener los datos del diagn√≥stico para informaci√≥n de contacto
    const backendUrl = import.meta.env.PUBLIC_BACKEND_URL || 'http://localhost:3000';
    console.log('üîç Fetching diagnostic data from:', `${backendUrl}/api/diagnostic/${id}`);
    
    const diagnosticResponse = await fetch(
      `${backendUrl}/api/diagnostic/${id}`
    );
    
    console.log('üì• Diagnostic data response status:', diagnosticResponse.status);
    
    if (diagnosticResponse.ok) {
      const diagnosticResponseData = await diagnosticResponse.json();
      console.log('üì• Diagnostic data response:', diagnosticResponseData);
      
      if (diagnosticResponseData.success) {
        diagnosticData = diagnosticResponseData.data;
        contactName = diagnosticData.nombre || '';
        contactCompany = diagnosticData.empresa || '';
        console.log('‚úÖ Contact info loaded:', { contactName, contactCompany });
      }
    } else {
      console.warn('‚ö†Ô∏è  Could not fetch diagnostic data for contact info');
    }
  } else {
    console.error('‚ùå Response not successful:', response);
    throw new Error(response.error || 'No se pudo obtener el resultado del diagn√≥stico');
  }
} catch (e: any) {
  error = e.message || 'Error desconocido';
  console.error('‚ùå Error loading diagnostic:', e);
  console.error('‚ùå Error stack:', e.stack);
}
---

<Layout 
  title={error ? `Error | Diagn√≥stico` : `Resultado de tu Diagn√≥stico | Maestro Digital`}
  description={error ? "Error al cargar el diagn√≥stico" : "Descubre la soluci√≥n digital perfecta para tu negocio basada en tu diagn√≥stico estrat√©gico."}
  image="/images/background-hero.jpg"
>
  {error ? (
    <section class="diagnostic-result">
      <div class="result-container">
        <div class="result-header">
          <div class="result-icon-large">‚ö†Ô∏è</div>
          <h1 class="result-title">Error al cargar el diagn√≥stico</h1>
          <p class="result-subtitle">{error}</p>
        </div>
        <div class="cta-group">
          <a href="/#diagnostico-estrategico" class="btn-cta-primary">
            Realizar nuevo diagn√≥stico
          </a>
          <a href="/soluciones" class="btn-cta-secondary">
            Ver todas las soluciones
          </a>
        </div>
      </div>
    </section>
  ) : diagnosticResult ? (
    <section class="diagnostic-result">
      <div class="result-container">
        {(() => {
          // Detectar si es un diagn√≥stico conversacional
          const isConversational = diagnosticResult.type === 'conversational' ||
                                  diagnosticResult.summary !== undefined ||
                                  diagnosticResult.insights !== undefined;
          
          // Detectar si es un envelope mejorado
          const isEnhanced = !isConversational && 
                           diagnosticResult.opportunity !== undefined && 
                           diagnosticResult.recommendation !== undefined;
          
          if (isConversational) {
            // Vista consultiva conversacional
            return (
              <>
                <!-- Mensaje Personalizado -->
                <div class="result-header">
                  <div class="result-icon-large">üìä</div>
                  <h1 class="result-title">{diagnosticResult.personalizedMessage?.greeting || 'Hola'}</h1>
                  <p class="result-subtitle">{diagnosticResult.personalizedMessage?.context || 'He analizado tu negocio'}</p>
                </div>

                <!-- Resumen de Costos y Ahorros -->
                {diagnosticResult.summary && (
                  <div class="cost-summary-section">
                    <h2 class="section-title">Resumen de tu Situaci√≥n Actual</h2>
                    <div class="cost-comparison">
                      <div class="cost-card current">
                        <div class="cost-label">Costo Actual</div>
                        <div class="cost-value time">
                          {Math.round(diagnosticResult.summary.totalCurrentCost?.timeHours || 0)} horas/semana
                        </div>
                        <div class="cost-value money">
                          ${Math.round(diagnosticResult.summary.totalCurrentCost?.moneyCost || 0)}/mes
                        </div>
                        <div class="cost-description">Tiempo y dinero que est√°s perdiendo en procesos manuales</div>
                      </div>
                      <div class="arrow">‚Üí</div>
                      <div class="cost-card potential">
                        <div class="cost-label">Ahorro Potencial</div>
                        <div class="cost-value time savings">
                          {Math.round(diagnosticResult.summary.totalPotentialSavings?.timeHours || 0)} horas/semana
                        </div>
                        <div class="cost-value money savings">
                          ${Math.round(diagnosticResult.summary.totalPotentialSavings?.moneyCost || 0)}/mes
                        </div>
                        <div class="cost-description">Tiempo y dinero que podr√≠as recuperar</div>
                      </div>
                    </div>
                    {diagnosticResult.summary.roi > 0 && (
                      <div class="roi-indicator">
                        <span class="roi-label">ROI Estimado:</span>
                        <span class="roi-value">{Math.round(diagnosticResult.summary.roi)}%</span>
                      </div>
                    )}
                  </div>
                )}

                <!-- Oportunidad -->
                {diagnosticResult.personalizedMessage?.opportunity && (
                  <div class="opportunity-section">
                    <h2 class="section-title">La Oportunidad</h2>
                    <p class="opportunity-text">{diagnosticResult.personalizedMessage.opportunity}</p>
                  </div>
                )}

                <!-- Insights Espec√≠ficos -->
                {diagnosticResult.insights && diagnosticResult.insights.length > 0 && (
                  <div class="insights-section">
                    <h2 class="section-title">Problemas Identificados y Soluciones</h2>
                    {diagnosticResult.insights.map((insight: any, index: number) => (
                      <div class="insight-card" key={index}>
                        <div class="insight-header">
                          <h3 class="insight-problem">{insight.problem}</h3>
                        </div>
                        <div class="insight-details">
                          <div class="insight-costs">
                            <div class="cost-item">
                              <span class="cost-label">Tiempo perdido:</span>
                              <span class="cost-value">{Math.round(insight.currentCost?.timeHours || 0)} horas/semana</span>
                            </div>
                            <div class="cost-item">
                              <span class="cost-label">Costo mensual:</span>
                              <span class="cost-value">${Math.round(insight.currentCost?.moneyCost || 0)}</span>
                            </div>
                            {insight.currentCost?.errorRate > 0 && (
                              <div class="cost-item">
                                <span class="cost-label">Tasa de errores:</span>
                                <span class="cost-value">{insight.currentCost.errorRate}%</span>
                              </div>
                            )}
                          </div>
                          <div class="insight-savings">
                            <div class="savings-label">Ahorro potencial:</div>
                            <div class="savings-values">
                              <span>{Math.round(insight.potentialSavings?.timeHours || 0)} horas/semana</span>
                              <span>${Math.round(insight.potentialSavings?.moneyCost || 0)}/mes</span>
                            </div>
                          </div>
                        </div>
                        {insight.impact && (
                          <div class="insight-impact">
                            <div class="impact-item">
                              <strong>Impacto operativo:</strong> {insight.impact.operational}
                            </div>
                            <div class="impact-item">
                              <strong>Impacto financiero:</strong> {insight.impact.financial}
                            </div>
                            <div class="impact-item">
                              <strong>Impacto en crecimiento:</strong> {insight.impact.growth}
                            </div>
                          </div>
                        )}
                        {insight.recommendation && (
                          <div class="insight-recommendation">
                            <h4 class="recommendation-title">Recomendaci√≥n: {insight.recommendation.tool}</h4>
                            <p class="recommendation-description">{insight.recommendation.description}</p>
                            {insight.recommendation.benefits && insight.recommendation.benefits.length > 0 && (
                              <ul class="benefits-list">
                                {insight.recommendation.benefits.map((benefit: string, i: number) => (
                                  <li key={i}>{benefit}</li>
                                ))}
                              </ul>
                            )}
                          </div>
                        )}
                      </div>
                    ))}
                  </div>
                )}

                <!-- Visi√≥n -->
                {diagnosticResult.personalizedMessage?.vision && (
                  <div class="vision-section">
                    <h2 class="section-title">Tu Visi√≥n</h2>
                    <p class="vision-text">{diagnosticResult.personalizedMessage.vision}</p>
                  </div>
                )}
              </>
            );
          } else if (isEnhanced) {
            // Vista mejorada con envelope completo
            return (
              <>
                <!-- Header con mensaje personalizado -->
                <div class="result-header">
                  <div class="result-icon-large">üí°</div>
                  <h1 class="result-title">{diagnosticResult.personalizedMessage.title}</h1>
                  <p class="result-subtitle">{diagnosticResult.personalizedMessage.subtitle}</p>
                </div>

                <!-- Insight personalizado -->
                <div class="result-insight">
                  <p>{diagnosticResult.personalizedMessage.insight}</p>
                </div>

                <!-- Oportunidad Detectada -->
                <div class="opportunity-section">
                  <div class="opportunity-header">
                    <h2 class="opportunity-title">{diagnosticResult.opportunity.title}</h2>
                    <p class="opportunity-description">{diagnosticResult.opportunity.description}</p>
                  </div>

                  <div class="opportunity-details">
                    <div class="pain-points">
                      <h3 class="section-title">Problemas Identificados</h3>
                      <ul class="points-list">
                        {diagnosticResult.opportunity.painPoints.map((point: string) => (
                          <li>{point}</li>
                        ))}
                      </ul>
                    </div>

                    <div class="benefits">
                      <h3 class="section-title">Beneficios de la Soluci√≥n</h3>
                      <ul class="points-list">
                        {diagnosticResult.opportunity.benefits.map((benefit: string) => (
                          <li>{benefit}</li>
                        ))}
                      </ul>
                    </div>
                  </div>
                </div>
              </>
            );
          } else {
            // Vista legacy
            return (
              <>
                <div class="result-header">
                  <div class="result-icon-large">{diagnosticResult.qualifies ? '‚úÖ' : 'üí°'}</div>
                  <h1 class="result-title">{diagnosticResult.personalizedMessage.title}</h1>
                  <p class="result-subtitle">{diagnosticResult.personalizedMessage.subtitle}</p>
                </div>
                <div class="result-insight">
                  <p>{diagnosticResult.personalizedMessage.insight}</p>
                </div>
              </>
            );
          }
        })()}

        <!-- Soluci√≥n Principal -->
        {(() => {
          const primarySolution = diagnosticResult.recommendation?.primarySolution || diagnosticResult.primarySolution;
          const nextSteps = diagnosticResult.nextSteps;
          
          if (!primarySolution || !nextSteps) {
            return null;
          }
          
          return (
            <div class="primary-solution">
              <div class="solution-badge">Soluci√≥n Recomendada</div>
              <div class="solution-card-primary">
                <div class="solution-icon-large">
                  {primarySolution.icon || 'üí°'}
                </div>
                <h2 class="solution-title">
                  {primarySolution.title || 'Soluci√≥n Recomendada'}
                </h2>
                <p class="solution-description">
                  {primarySolution.description || 'Una soluci√≥n dise√±ada espec√≠ficamente para tu negocio'}
                </p>
                {primarySolution.reason && (
                  <div class="solution-reason">
                    <span class="reason-icon">üí°</span>
                    <span>{primarySolution.reason}</span>
                  </div>
                )}
                {primarySolution.matchScore !== undefined && (
                  <div class="solution-match">
                    <div class="match-bar">
                      <div class="match-fill" style={`width: ${primarySolution.matchScore}%`}></div>
                    </div>
                    <span class="match-text">Coincidencia: {primarySolution.matchScore}%</span>
                  </div>
                )}
                {nextSteps.primary && (
                  <a href={nextSteps.primary.link} class="btn-primary-large">
                    {nextSteps.primary.text} ‚Üí
                  </a>
                )}
              </div>
            </div>
          );
        })()}

        <!-- M√≥dulos Recomendados (solo para envelope mejorado) -->
        {diagnosticResult.resultProfile?.recommendedModules && (
          <div class="modules-section">
            <h3 class="modules-title">M√≥dulos Recomendados</h3>
            <p class="modules-subtitle">Estos m√≥dulos est√°n incluidos en la soluci√≥n recomendada</p>
            <div class="modules-grid">
              {diagnosticResult.resultProfile.recommendedModules.map((module: string) => (
                <div class="module-card">
                  <span class="module-name">{module.replace(/-/g, ' ')}</span>
                </div>
              ))}
            </div>
          </div>
        )}

        <!-- Soluciones Complementarias -->
        {(() => {
          const complementarySolutions = diagnosticResult.recommendation?.complementarySolutions || diagnosticResult.complementarySolutions || [];
          return complementarySolutions.length > 0 && (
            <div class="complementary-solutions">
              <h3 class="complementary-title">Tambi√©n te puede interesar</h3>
              <p class="complementary-subtitle">Estas soluciones pueden complementar tu estrategia digital</p>
              <div class="solutions-grid">
                {complementarySolutions.map((solution: any) => (
                  <a href={`${solution.link}?from=diagnostico`} class="solution-card-complementary">
                    <div class="solution-icon">{solution.icon}</div>
                    <h4 class="solution-card-title">{solution.title}</h4>
                    <p class="solution-card-description">{solution.description}</p>
                    <div class="solution-card-reason">
                      <span class="reason-icon-small">üí°</span>
                      <span>{solution.reason}</span>
                    </div>
                    <span class="solution-link">Ver soluci√≥n ‚Üí</span>
                  </a>
                ))}
              </div>
            </div>
          );
        })()}

        <!-- Urgencia y CTA Final -->
        <div class="result-cta-section">
          <div class="urgency-indicator" data-urgency={diagnosticResult.urgency}>
            {diagnosticResult.urgency === 'high' && (
              <>
                <span class="urgency-icon">‚ö°</span>
                <span class="urgency-text">Tu negocio necesita esta soluci√≥n ahora</span>
              </>
            )}
            {diagnosticResult.urgency === 'medium' && (
              <>
                <span class="urgency-icon">üìà</span>
                <span class="urgency-text">Esta soluci√≥n puede acelerar tu crecimiento</span>
              </>
            )}
            {diagnosticResult.urgency === 'low' && (
              <>
                <span class="urgency-icon">‚ú®</span>
                <span class="urgency-text">Esta soluci√≥n puede optimizar tu operaci√≥n</span>
              </>
            )}
          </div>
          
          <div class="cta-group">
            <a href={diagnosticResult.nextSteps.primary.link} class="btn-cta-primary">
              {diagnosticResult.nextSteps.primary.text}
            </a>
            {diagnosticResult.nextSteps.secondary && (
              <a href={diagnosticResult.nextSteps.secondary.link} class="btn-cta-secondary">
                {diagnosticResult.nextSteps.secondary.text}
              </a>
            )}
            {(() => {
              const contactParams = contactName || contactCompany 
                ? `?name=${encodeURIComponent(contactName)}&company=${encodeURIComponent(contactCompany)}`
                : '';
              return (
                <a href={`/contacto${contactParams}`} class="btn-cta-tertiary">
                  {diagnosticResult.opportunity ? 'Solicitar validaci√≥n operativa' : 'Hablar con un especialista'}
                </a>
              );
            })()}
          </div>
        </div>
      </div>
    </section>
  ) : (
    <section class="diagnostic-result">
      <div class="result-container">
        <div class="loading-state">
          <div class="loading-spinner"></div>
          <p>Cargando tu diagn√≥stico...</p>
        </div>
      </div>
    </section>
  )}
</Layout>

<style>
  .diagnostic-result {
    min-height: 100vh;
    padding: 6rem 2rem 4rem;
    background: var(--color-elephant-white, #F6F5F2);
  }

  .result-container {
    max-width: 1000px;
    margin: 0 auto;
  }

  /* Loading State */
  .loading-state {
    text-align: center;
    padding: 4rem 2rem;
  }

  .loading-spinner {
    width: 50px;
    height: 50px;
    border: 4px solid #E5E5E3;
    border-top-color: #2B2B2B;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto 1.5rem;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  /* Header */
  .result-header {
    text-align: center;
    margin-bottom: 3rem;
  }

  .result-icon-large {
    font-size: 4rem;
    margin-bottom: 1.5rem;
  }

  .result-title {
    font-family: 'Libre Baskerville', serif;
    font-size: clamp(2rem, 5vw, 3.5rem);
    font-weight: 700;
    color: var(--color-graphite-dark, #2B2B2B);
    margin-bottom: 1rem;
    line-height: 1.2;
  }

  .result-subtitle {
    font-size: clamp(1.125rem, 2vw, 1.5rem);
    color: var(--color-grey-medium, #9A9A97);
    line-height: 1.6;
  }

  /* Insight */
  .result-insight {
    background: #FFFFFF;
    border-left: 4px solid #2B2B2B;
    padding: 1.5rem 2rem;
    margin-bottom: 3rem;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
  }

  .result-insight p {
    font-size: 1.125rem;
    line-height: 1.8;
    color: var(--color-graphite-dark, #2B2B2B);
    margin: 0;
  }

  /* Opportunity Section */
  .opportunity-section {
    background: #FFFFFF;
    border-radius: 16px;
    padding: 3rem;
    margin-bottom: 3rem;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  }

  .opportunity-header {
    text-align: center;
    margin-bottom: 2.5rem;
  }

  .opportunity-title {
    font-family: 'Libre Baskerville', serif;
    font-size: clamp(1.75rem, 4vw, 2.5rem);
    font-weight: 700;
    color: var(--color-graphite-dark, #2B2B2B);
    margin-bottom: 1rem;
  }

  .opportunity-description {
    font-size: 1.125rem;
    color: var(--color-grey-medium, #9A9A97);
    line-height: 1.6;
  }

  .opportunity-details {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
    margin-top: 2rem;
  }

  .pain-points, .benefits {
    background: #F6F5F2;
    padding: 2rem;
    border-radius: 12px;
  }

  /* Estilos para secciones conversacionales - deben tener mayor especificidad */
  .cost-summary-section .section-title,
  .insights-section .section-title,
  .opportunity-section .section-title,
  .vision-section .section-title {
    font-family: 'Libre Baskerville', serif;
    font-size: clamp(1.5rem, 3vw, 2rem) !important;
    font-weight: 700 !important;
    color: var(--color-graphite-dark, #2B2B2B) !important;
    margin-bottom: 1.5rem !important;
    text-align: center !important;
  }

  .section-title {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--color-graphite-dark, #2B2B2B);
    margin-bottom: 1.5rem;
  }

  .points-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .points-list li {
    padding: 0.75rem 0;
    padding-left: 1.5rem;
    position: relative;
    font-size: 1rem;
    line-height: 1.6;
    color: var(--color-graphite-dark, #2B2B2B);
  }

  .pain-points .points-list li::before {
    content: '‚ö†Ô∏è';
    position: absolute;
    left: 0;
  }

  .benefits .points-list li::before {
    content: '‚úÖ';
    position: absolute;
    left: 0;
  }

  /* Modules Section */
  .modules-section {
    background: #FFFFFF;
    border-radius: 16px;
    padding: 3rem;
    margin-bottom: 3rem;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  }

  .modules-title {
    font-family: 'Libre Baskerville', serif;
    font-size: clamp(1.5rem, 3vw, 2rem);
    font-weight: 700;
    color: var(--color-graphite-dark, #2B2B2B);
    text-align: center;
    margin-bottom: 0.5rem;
  }

  .modules-subtitle {
    text-align: center;
    color: var(--color-grey-medium, #9A9A97);
    margin-bottom: 2rem;
  }

  .modules-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 1rem;
  }

  .module-card {
    background: #F6F5F2;
    padding: 1rem;
    border-radius: 8px;
    text-align: center;
  }

  .module-name {
    font-size: 0.95rem;
    font-weight: 600;
    color: var(--color-graphite-dark, #2B2B2B);
    text-transform: capitalize;
  }

  /* Primary Solution */
  .primary-solution {
    margin-bottom: 4rem;
  }

  .solution-badge {
    display: inline-block;
    background: #2B2B2B;
    color: #FFFFFF;
    padding: 0.5rem 1.5rem;
    border-radius: 999px;
    font-size: 0.875rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 1.5rem;
  }

  .solution-card-primary {
    background: #FFFFFF;
    border-radius: 16px;
    padding: 3rem;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    text-align: center;
  }

  .solution-icon-large {
    font-size: 4rem;
    margin-bottom: 1.5rem;
  }

  .solution-title {
    font-family: 'Libre Baskerville', serif;
    font-size: clamp(1.75rem, 4vw, 2.5rem);
    font-weight: 700;
    color: var(--color-graphite-dark, #2B2B2B);
    margin-bottom: 1rem;
  }

  .solution-description {
    font-size: 1.125rem;
    line-height: 1.8;
    color: var(--color-grey-medium, #9A9A97);
    margin-bottom: 1.5rem;
  }

  .solution-reason {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    background: #F6F5F2;
    padding: 1rem 1.5rem;
    border-radius: 8px;
    margin-bottom: 1.5rem;
    font-size: 1rem;
    color: var(--color-graphite-dark, #2B2B2B);
  }

  .reason-icon {
    font-size: 1.25rem;
  }

  .solution-match {
    margin-bottom: 2rem;
  }

  .match-bar {
    width: 100%;
    height: 8px;
    background: #E5E5E3;
    border-radius: 999px;
    overflow: hidden;
    margin-bottom: 0.5rem;
  }

  .match-fill {
    height: 100%;
    background: linear-gradient(90deg, #2B2B2B 0%, #4A4A4A 100%);
    transition: width 0.3s ease;
  }

  .match-text {
    font-size: 0.875rem;
    color: var(--color-grey-medium, #9A9A97);
  }

  .btn-primary-large {
    display: inline-block;
    background: #2B2B2B;
    color: #FFFFFF;
    padding: 1rem 2.5rem;
    border-radius: 8px;
    font-size: 1.125rem;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.3s ease;
  }

  .btn-primary-large:hover {
    background: #1A1A1A;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(43, 43, 43, 0.3);
  }

  /* Complementary Solutions */
  .complementary-solutions {
    margin-bottom: 4rem;
  }

  .complementary-title {
    font-family: 'Libre Baskerville', serif;
    font-size: clamp(1.5rem, 3vw, 2rem);
    font-weight: 700;
    color: var(--color-graphite-dark, #2B2B2B);
    text-align: center;
    margin-bottom: 0.5rem;
  }

  .complementary-subtitle {
    text-align: center;
    color: var(--color-grey-medium, #9A9A97);
    margin-bottom: 2rem;
  }

  .solutions-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1.5rem;
  }

  .solution-card-complementary {
    background: #FFFFFF;
    border-radius: 12px;
    padding: 2rem;
    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
    text-decoration: none;
    transition: all 0.3s ease;
    display: block;
  }

  .solution-card-complementary:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
  }

  .solution-icon {
    font-size: 2.5rem;
    margin-bottom: 1rem;
  }

  .solution-card-title {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--color-graphite-dark, #2B2B2B);
    margin-bottom: 0.75rem;
  }

  .solution-card-description {
    font-size: 0.95rem;
    color: var(--color-grey-medium, #9A9A97);
    line-height: 1.6;
    margin-bottom: 1rem;
  }

  .solution-card-reason {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
    color: var(--color-graphite-dark, #2B2B2B);
    margin-bottom: 1rem;
  }

  .reason-icon-small {
    font-size: 1rem;
  }

  .solution-link {
    display: inline-block;
    color: #2B2B2B;
    font-weight: 600;
    font-size: 0.95rem;
  }

  /* Urgency and CTA */
  .result-cta-section {
    text-align: center;
    padding-top: 3rem;
    border-top: 1px solid #E5E5E3;
  }

  .urgency-indicator {
    display: inline-flex;
    align-items: center;
    gap: 0.75rem;
    padding: 1rem 2rem;
    border-radius: 8px;
    margin-bottom: 2rem;
    font-weight: 600;
  }

  .urgency-indicator[data-urgency="high"] {
    background: #FEE2E2;
    color: #991B1B;
  }

  .urgency-indicator[data-urgency="medium"] {
    background: #FEF3C7;
    color: #92400E;
  }

  .urgency-indicator[data-urgency="low"] {
    background: #DBEAFE;
    color: #1E40AF;
  }

  .urgency-icon {
    font-size: 1.5rem;
  }

  .urgency-text {
    font-size: 1.125rem;
  }

  .cta-group {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    justify-content: center;
    align-items: center;
  }

  .btn-cta-primary {
    display: inline-block;
    background: #2B2B2B;
    color: #FFFFFF;
    padding: 1rem 2rem;
    border-radius: 8px;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.3s ease;
  }

  .btn-cta-primary:hover {
    background: #1A1A1A;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(43, 43, 43, 0.3);
  }

  .btn-cta-secondary {
    display: inline-block;
    background: transparent;
    color: #2B2B2B;
    border: 2px solid #2B2B2B;
    padding: 1rem 2rem;
    border-radius: 8px;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.3s ease;
  }

  .btn-cta-secondary:hover {
    background: #2B2B2B;
    color: #FFFFFF;
  }

  .btn-cta-tertiary {
    display: inline-block;
    color: var(--color-grey-medium, #9A9A97);
    padding: 1rem 2rem;
    font-weight: 600;
    text-decoration: none;
    transition: color 0.3s ease;
  }

  .btn-cta-tertiary:hover {
    color: #2B2B2B;
  }

  /* ============================================
     ESTILOS PARA VISTA CONSULTIVA CONVERSACIONAL
     ============================================ */
  
  .cost-summary-section {
    margin-bottom: 3rem;
    background: #FFFFFF;
    border-radius: 16px;
    padding: 3rem;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    width: 100%;
    display: block;
  }

  .cost-comparison {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 2rem;
    margin: 2rem 0;
    flex-wrap: wrap;
  }

  .cost-card {
    background: #FFFFFF;
    border-radius: 12px;
    padding: 2rem;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    min-width: 250px;
    max-width: 300px;
    text-align: center;
    flex: 1;
    display: block;
    width: 100%;
  }

  .cost-card.current {
    border: 2px solid #DC2626;
  }

  .cost-card.potential {
    border: 2px solid #10B981;
  }

  .cost-label {
    font-size: 0.875rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 1rem;
    color: var(--color-grey-medium, #9A9A97);
  }

  .cost-value {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--color-graphite-dark, #2B2B2B);
    margin: 0.5rem 0;
  }

  .cost-value.savings {
    color: #10B981;
  }

  .cost-description {
    font-size: 0.875rem;
    color: var(--color-grey-medium, #9A9A97);
    margin-top: 1rem;
  }

  .arrow {
    font-size: 2rem;
    color: var(--color-grey-medium, #9A9A97);
  }

  .roi-indicator {
    text-align: center;
    margin-top: 2rem;
    padding: 1rem;
    background: #F0FDF4;
    border-radius: 8px;
  }

  .roi-label {
    font-size: 1rem;
    color: var(--color-grey-medium, #9A9A97);
    margin-right: 0.5rem;
  }

  .roi-value {
    font-size: 1.5rem;
    font-weight: 700;
    color: #10B981;
  }

  .opportunity-section,
  .vision-section {
    background: #FFFFFF !important;
    border-radius: 12px !important;
    padding: 2rem !important;
    margin-bottom: 3rem !important;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1) !important;
    display: block !important;
  }

  .opportunity-text,
  .vision-text {
    font-size: 1.125rem;
    line-height: 1.8;
    color: var(--color-graphite-dark, #2B2B2B);
    margin-top: 1rem;
  }

  .insights-section {
    margin-bottom: 3rem;
    width: 100%;
    display: block;
  }

  .insight-card {
    background: #FFFFFF !important;
    border-radius: 12px !important;
    padding: 2rem !important;
    margin-bottom: 2rem !important;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1) !important;
    border-left: 4px solid #2B2B2B !important;
    display: block !important;
  }

  .insight-problem {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--color-graphite-dark, #2B2B2B);
    margin-bottom: 1.5rem;
  }

  .insight-details {
    display: grid !important;
    grid-template-columns: 1fr 1fr !important;
    gap: 2rem !important;
    margin-bottom: 1.5rem !important;
    width: 100% !important;
  }

  .insight-costs,
  .insight-savings {
    padding: 1rem !important;
    background: #F6F5F2 !important;
    border-radius: 8px !important;
    display: block !important;
    width: 100% !important;
  }

  .cost-item {
    display: flex;
    justify-content: space-between;
    margin-bottom: 0.5rem;
    font-size: 0.95rem;
  }

  .cost-item .cost-label {
    color: var(--color-grey-medium, #9A9A97);
    font-weight: 500;
    text-transform: none;
    letter-spacing: normal;
    margin: 0;
  }

  .cost-item .cost-value {
    font-size: 1rem;
    font-weight: 600;
    color: var(--color-graphite-dark, #2B2B2B);
    margin: 0;
  }

  .savings-label {
    font-size: 0.875rem;
    font-weight: 600;
    color: #10B981;
    margin-bottom: 0.5rem;
  }

  .savings-values {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .savings-values span {
    font-size: 1rem;
    font-weight: 600;
    color: #10B981;
  }

  .insight-impact {
    margin: 1.5rem 0 !important;
    padding: 1rem !important;
    background: #FEF3C7 !important;
    border-radius: 8px !important;
    display: block !important;
    width: 100% !important;
  }

  .impact-item {
    margin-bottom: 0.75rem;
    font-size: 0.95rem;
    line-height: 1.6;
    color: var(--color-graphite-dark, #2B2B2B);
  }

  .impact-item:last-child {
    margin-bottom: 0;
  }

  .insight-recommendation {
    margin-top: 1.5rem !important;
    padding-top: 1.5rem !important;
    border-top: 1px solid #E5E5E3 !important;
    display: block !important;
    width: 100% !important;
  }

  .insight-header {
    display: block !important;
    width: 100% !important;
    margin-bottom: 1.5rem !important;
  }

  .cost-comparison {
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    gap: 2rem !important;
    margin: 2rem 0 !important;
    flex-wrap: wrap !important;
    width: 100% !important;
  }

  .arrow {
    display: inline-block !important;
    font-size: 2rem !important;
    color: var(--color-grey-medium, #9A9A97) !important;
  }

  .recommendation-title {
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--color-graphite-dark, #2B2B2B);
    margin-bottom: 0.75rem;
  }

  .recommendation-description {
    font-size: 1rem;
    line-height: 1.6;
    color: var(--color-grey-medium, #9A9A97);
    margin-bottom: 1rem;
  }

  .benefits-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .benefits-list li {
    padding: 0.5rem 0;
    padding-left: 1.5rem;
    position: relative;
    font-size: 0.95rem;
    color: var(--color-graphite-dark, #2B2B2B);
  }

  .benefits-list li:before {
    content: '‚úì';
    position: absolute;
    left: 0;
    color: #10B981;
    font-weight: bold;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .diagnostic-result {
      padding: 4rem 1rem 2rem;
    }

    .solution-card-primary {
      padding: 2rem 1.5rem;
    }

    .opportunity-details {
      grid-template-columns: 1fr;
    }

    .solutions-grid {
      grid-template-columns: 1fr;
    }

    .modules-grid {
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    }

    .cta-group {
      flex-direction: column;
    }

    .btn-cta-primary,
    .btn-cta-secondary,
    .btn-cta-tertiary {
      width: 100%;
      text-align: center;
    }

    .cost-comparison {
      flex-direction: column;
      gap: 1rem;
    }

    .arrow {
      transform: rotate(90deg);
    }

    .insight-details {
      grid-template-columns: 1fr;
      gap: 1rem;
    }
  }
</style>
